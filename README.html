<!--
    Pardon for distributing this text in HTML.
    I do so, because I can then easier distribute it on my website.
    I will try to make a POD later...
-->

<h2>SNMP::Effective</h2>

<h3>Usage</h3>
<p>
Read "The interface" below, or check out my proceeding from YAPC::Europe::2006:
<a href="http://home.flodhest.net/perl/birmingham2006/">speeding up snmp queries.</a>.
</p>

<h2>The interface</h2>
<h3>SNMP::Effective-&gt;new( ... );</h3>
<P>This method returns a SNMP::Effective object
(refered to as <CODE>$snmp_effective</CODE> later in
this document) . Arguments to the constructor can be<SPAN STYLE="text-decoration: none">:</SPAN></P>

<pre>MaxSessions   =&gt; int # maximum number of simultainious SNMP session
MasterTimeout =&gt; int # maximum number of seconds before killing <I>execute</I></pre>
<P>All other arguments are passed on to
<I>SNMP::Effective::Var::new</I><SPAN STYLE="font-style: normal">,
which from a users views is the same as calling </SPAN><CODE>$snmp_effective-&gt;add(
[args] )</CODE><SPAN STYLE="font-style: normal">.</SPAN></P>
<h3>$snmp_effective-&gt;add( ... );</h3>

<P>Arguments to this method can be:</P>
<pre>DestHost =&gt; []     # an array-ref that contains a list of hosts, in this format:
                   # xxx.xxx.xxx.xxx or a hostname
Arg      =&gt; {}     # arguments passed on to <I>SNMP::Session</I>
Callback =&gt; sub {} # the callback method whick handles the received data
get      =&gt; []     # an array-ref that contains a list of OIDs to get
walk     =&gt; []     # an array-ref that contains a list of OIDs “trees” to get
set      =&gt; []     # an array-ref that contains a list of OIDs to set</pre>

<P>This can be called with many different
combinations, such as:</P>
<UL>
    <LI><P>DestHost / any other argument: This will make
    changes pr. DestHost. You can then change Arg, Callback, or add OIDs
    on host-basis.</P>
    <LI><P>get / walk / set: The OID list submitted to
    add() will be added to all DestHosts, if it's no DestHost is
    spesified.</P>
    <LI><P>Arg / Callback: This can be used to alter all
    hosts SNMP-arguments or callback method.</P>
</UL>
<h3>$snmp_effective-&gt;execute;</h3>
    <P>This method starts setting / getting data. It
    will run as long as necessarily, or until <CODE>MasterTimeout</CODE>
    is reached. Every time the some data is set / retrieved, it will
    call the callback-method, defined pr. host.</P>

<h2>SNMP::Effective's callback method</h2>
<P>When SNMP is done collecting data from a host, it
calls a callback method, provided by the <CODE><FONT FACE="Bitstream Vera Sans Mono, sans-serif">Callback
=&gt; sub{}</FONT></CODE><FONT SIZE=3><FONT FACE="Bitstream Vera Sans, sans-serif">
argument. Here is an example on a callback method:</FONT></FONT></P>
<pre>my my_callback {

    my $host  = shift;
    my $error = shift;

    if($error) {
        warn “$host failed with this error: $error”;
        return;
    }
    
    my $data = $host-&gt;data;

    PRINT_DATA:
    for my $oid (%$data) {
        print “$host returned oid “$oid” with this data:\n”;
        print join “\n\t”, map {
            "$_ =&gt; $data-&gt;{$oid}{$_}”;
        } keys %{ $data-&gt;{$oid} };
        print "\n";
    }
}</pre>
<P>Example output:</P>

<pre>10.2.10.3 returned oid “1.3.6.1.2.1.1.1” with this data: 1 =&gt;
C12-MM4-CS, Hardware V4 &lt;&lt;VENDOR: BigBand; BOOTR: &gt;&gt;
(ser#0600012893, part#90000046000, rev#A2, opt#c02), v6.0.1(14) ,
Release6.0_Integration Built 2006_03_29_153010</pre>
<h2>Debugging</h2>
<P>By setting <CODE CLASS="western">$SNMP::Effective::DEBUG</CODE>
you will get a debugging information printed to STDERR. There are no
strict debugging levels (yet), but setting it to <CODE>“100”</CODE>
will output <I>a lot</I> of information. 

</P>
<h2>References</h2>
<UL>
    <LI><P>SNMP module:
    <FONT COLOR="#000080"><a href="http://search.cpan.org/~gsm/SNMP-4.2.0/SNMP.pm">http://search.cpan.org/~gsm/SNMP-4.2.0/SNMP.pm</a></FONT></P>
</UL>
